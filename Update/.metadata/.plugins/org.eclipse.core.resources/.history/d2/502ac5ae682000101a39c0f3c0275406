<%@ page language="java" contentType="text/html; charset=UTF-8"
         pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="ISO-8859-1">
    <title>Fare Enquiry — E-Trains</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-…"
          crossorigin="anonymous">
  </head>
  <body>

    <!-- NAVBAR (unchanged) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">National Ticket Booking Spot</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="userhome">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="userviewtrainfwd">View Trains</a></li>
            <li class="nav-item"><a class="nav-link" href="trainbwstnfwd">Between Stations</a></li>
            <li class="nav-item"><a class="nav-link" href="bookingdetails">History</a></li>
            <li class="nav-item"><a class="nav-link active" href="fareenqfwd">Fare Enquiry</a></li>
            <li class="nav-item"><a class="nav-link" href="useravailfwd">Seat Availability</a></li>
            <li class="nav-item"><a class="nav-link" href="usersearchtrain">Search By TrainNo</a></li>
            <li class="nav-item"><a class="nav-link" href="userprofile">Profile</a></li>
            <li class="nav-item"><a class="nav-link" href="userlogout">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-5">
      <!-- Fare-Enquiry Form -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Fare Enquiry for Trains Between Stations</h5>
        </div>
        <div class="card-body">
          <form action="fareenq" method="post" class="row g-3">
            <div class="col-md-6">
              <label for="fromstation" class="form-label">From Station</label>
              <input type="text" class="form-control" id="fromstation" name="fromstation"
                     value="${fromStation}" required>
            </div>
            <div class="col-md-6">
              <label for="tostation" class="form-label">To Station</label>
              <input type="text" class="form-control" id="tostation" name="tostation"
                     value="${toStation}" required>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Get Fare</button>
            </div>
          </form>
        </div>
      </div>

      <!-- If there are trains, show Bootstrap table -->
      <c:if test="${not empty trains}">
        <div class="card shadow-sm mb-4">
          <div class="card-header">
            Fare for Trains Between <strong>${fromStation}</strong> and <strong>${toStation}</strong>
          </div>
          <div class="card-body">
            <table class="table table-striped table-bordered align-middle">
              <thead class="table-light">
                <tr>
                  <th>Train Name</th>
                  <th>Train No</th>
                  <th>From Stn</th>
                  <th>To Stn</th>
                  <th>Time</th>
                  <th>Seats</th>
                  <th>Fare (INR)</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <c:forEach var="train" items="${trains}">
                  <% 
                    int hr = (int)(Math.random() * 24);
                    int min = (int)(Math.random() * 60);
                    String time = (hr < 10 ? "0"+hr : hr) + ":" 
                                + (min < 10 ? "0"+min : min);
                  %>
                  <tr>
                    <td>${train.tr_name}</td>
                    <td>${train.tr_no}</td>
                    <td>${train.from_stn}</td>
                    <td>${train.to_stn}</td>
                    <td><%= time %></td>
                    <td>${train.seats}</td>
                    <td>${train.fare} RS</td>
                    <td>
                      <a href="booktrainbyref?trainNo=${train.tr_no}
                                 &fromStn=${train.from_stn}
                                 &toStn=${train.to_stn}"
                         class="btn btn-sm btn-danger">
                        Book Now
                      </a>
                    </td>
                  </tr>
                </c:forEach>
              </tbody>
            </table>
          </div>
        </div>
      </c:if>

      <!-- If no trains found -->
      <c:if test="${empty trains and not empty fromStation}">
        <div class="alert alert-warning">
          There are no trains between <strong>${fromStation}</strong> and <strong>${toStation}</strong>.
        </div>
      </c:if>
    </div>

    <!-- Bootstrap JS bundle (Popper + JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-…"
            crossorigin="anonymous"></script>
  </body>
</html>
