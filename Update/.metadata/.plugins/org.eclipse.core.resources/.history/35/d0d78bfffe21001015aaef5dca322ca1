// ChangeUserPassword.java (GET)
package com.tms.servlets;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.*;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.RequestDispatcher;

import com.tms.constant.UserRole;
import com.tms.utils.TrainUtil;

@SuppressWarnings("serial")
@WebServlet("/changeuserpassword")
public class ChangeUserPassword extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {
        res.setContentType("text/html");
        PrintWriter pw = res.getWriter();
        TrainUtil.validateUserAuthorization(req, UserRole.CUSTOMER);

        RequestDispatcher rd = req.getRequestDispatcher("UserHome.jsp");
        rd.include(req, res);

        String cp = req.getContextPath();

        pw.println("<div class='container d-flex flex-column justify-content-center align-items-center' style='min-height:70vh;'>");

        // optional alert
        String msg = req.getParameter("msg"), type = req.getParameter("msgType");
        if (msg != null) {
            pw.println("<div class='alert alert-" + (type!=null?type:"danger")
                     + " text-center w-100' role='alert'>" + msg + "</div>");
        }
        if (msg != null && !msg.isEmpty()) {
            String alertClass = "success".equals(msg) ? "alert-success" : "alert-danger";
            pw.println("<div class='alert " + alertClass + " alert-dismissible fade show' role='alert'>");
            pw.println(msg);
            pw.println("<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>");
            pw.println("</div>");
        }

        // form
        pw.println("  <div class='row justify-content-center w-100'>");
        pw.println("    <div class='col-md-6'>");
        pw.println("      <div class='card shadow-sm'>");
        pw.println("        <div class='card-header text-center'><h4>Change Password</h4></div>");
        pw.println("        <div class='card-body'>");
        pw.println("          <form action='" + cp + "/changeuserpwd' method='post'>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>User Name:</label><div class='col-sm-8'><input type='text' name='username' class='form-control' placeholder='Enter Your MailId'></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>Old Password:</label><div class='col-sm-8'><input type='password' name='oldpassword' class='form-control'></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>New Password:</label><div class='col-sm-8'><input type='password' name='newpassword' class='form-control'></div></div>");
        pw.println("            <div class='text-center'><button type='submit' class='btn btn-primary'>Change Password</button></div>");
        pw.println("          </form>");
        pw.println("        </div>");
        pw.println("      </div>");
        pw.println("    </div>");
        pw.println("  </div>");

        pw.println("</div>");  // flex container

        pw.println("<footer class='footer bg-light py-3'>");
        pw.println("  <div class='container text-center'><span class='text-muted'>&copy; 2025 NITRTC. All rights reserved.</span></div>");
        pw.println("</footer>");
    }
}
