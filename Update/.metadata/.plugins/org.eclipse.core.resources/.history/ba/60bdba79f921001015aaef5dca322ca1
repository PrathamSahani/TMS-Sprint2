// EditUserProfile.java
package com.tms.servlets;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.*;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.RequestDispatcher;

import com.tms.beans.UserBean;
import com.tms.constant.UserRole;
import com.tms.utils.TrainUtil;

@SuppressWarnings("serial")
@WebServlet("/edituserprofile")
public class EditUserProfile extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {
        res.setContentType("text/html");
        PrintWriter pw = res.getWriter();
        TrainUtil.validateUserAuthorization(req, UserRole.CUSTOMER);

        UserBean ub = TrainUtil.getCurrentCustomer(req);
        RequestDispatcher rd = req.getRequestDispatcher("UserHome.jsp");
        rd.include(req, res);

        String cp = req.getContextPath();

        pw.println("<div class='container' style='margin-top:200px;'>");

        // optional alert
        String msg = req.getParameter("msg"), type = req.getParameter("msgType");
        if (msg != null) {
            pw.println("<div class='alert alert-" + (type!=null?type:"info")
                     + " text-center' role='alert'>" + msg + "</div>");
        }

        // form card
        pw.println("  <div class='row justify-content-center'>");
        pw.println("    <div class='col-md-6'>");
        pw.println("      <div class='card'>");
        pw.println("        <div class='card-header text-center'><h4>Update Profile</h4></div>");
        pw.println("        <div class='card-body'>");
        pw.println("          <form action='" + cp + "/updateuserprofile' method='post'>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>User Name:</label><div class='col-sm-8'><input type='text' class='form-control' value='"
                 + ub.getMailId() + "' disabled></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>First Name:</label><div class='col-sm-8'><input type='text' name='firstname' class='form-control' value='"
                 + ub.getFName() + "'></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>Last Name:</label><div class='col-sm-8'><input type='text' name='lastname' class='form-control' value='"
                 + ub.getLName() + "'></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>Address:</label><div class='col-sm-8'><input type='text' name='address' class='form-control' value='"
                 + ub.getAddr() + "'></div></div>");
        pw.println("            <div class='mb-3 row'><label class='col-sm-4 col-form-label'>Phone No:</label><div class='col-sm-8'><input type='text' name='phone' class='form-control' value='"
                 + ub.getPhNo() + "'></div></div>");
        pw.println("            <input type='hidden' name='mail' value='" + ub.getMailId() + "'/>");
        pw.println("            <div class='text-center'><button type='submit' class='btn btn-primary'>Update Profile</button></div>");
        pw.println("          </form>");
        pw.println("        </div>");
        pw.println("      </div>");
        pw.println("    </div>");
        pw.println("  </div>");

        pw.println("</div>");  // container

        pw.println("<footer class='footer bg-light py-3'>");
        pw.println("  <div class='container text-center'><span class='text-muted'>&copy; 2025 NITRTC. All rights reserved.</span></div>");
        pw.println("</footer>");
    }
}
